{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Page header -->
      <div class="mb-4">
        <a href="{% url 'beads:list' %}" class="text-muted text-decoration-none" style="font-size:.85rem;">
          <i class="bi bi-arrow-left me-1"></i>Retour à la collection
        </a>
        <h2 class="mt-2 mb-0">
          {% if form.instance.pk %}Modifier{% else %}Ajouter{% endif %} une perle
        </h2>
      </div>

      <form method="post">
        {% csrf_token %}
        <div class="row g-4">
          <!-- Color section -->
          <div class="col-md-6">
            <div class="card border-0 shadow-sm">
              <div class="card-body">
                <h6 class="text-uppercase text-muted mb-3" style="font-size:.75rem; letter-spacing:.05em;">Couleur</h6>
                <div id="colorPreview" class="mb-3 rounded-3" style="height: 80px; background-color: rgb({{ form.instance.red|default:'0' }}, {{ form.instance.green|default:'0' }}, {{ form.instance.blue|default:'0' }});"></div>
                <div class="row g-2">
                  <div class="col-4">{{ form.red|as_crispy_field }}</div>
                  <div class="col-4">{{ form.green|as_crispy_field }}</div>
                  <div class="col-4">{{ form.blue|as_crispy_field }}</div>
                </div>
                <div class="mt-3">
                  <label class="form-label text-muted" style="font-size:.82rem;">Couleurs rapides</label>
                  <div class="d-flex flex-wrap gap-2">
                    {% for hex, r, g, b in color_presets %}
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:{{ hex }}; cursor:pointer;" data-r="{{ r }}" data-g="{{ g }}" data-b="{{ b }}"></button>
                    {% empty %}
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#ff0000;" data-r="255" data-g="0" data-b="0"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#00ff00;" data-r="0" data-g="255" data-b="0"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#0000ff;" data-r="0" data-g="0" data-b="255"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#ffff00;" data-r="255" data-g="255" data-b="0"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#ff00ff;" data-r="255" data-g="0" data-b="255"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#00ffff;" data-r="0" data-g="255" data-b="255"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#000000;" data-r="0" data-g="0" data-b="0"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#ffffff;" data-r="255" data-g="255" data-b="255"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#808080;" data-r="128" data-g="128" data-b="128"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#ffa500;" data-r="255" data-g="165" data-b="0"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#a52a2a;" data-r="165" data-g="42" data-b="42"></button>
                      <button type="button" class="color-btn rounded-circle border" style="width:28px; height:28px; background-color:#ffc0cb;" data-r="255" data-g="192" data-b="203"></button>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Info section -->
          <div class="col-md-6">
            <div class="card border-0 shadow-sm">
              <div class="card-body">
                <h6 class="text-uppercase text-muted mb-3" style="font-size:.75rem; letter-spacing:.05em;">Informations</h6>
                {{ form.name|as_crispy_field }}
                {{ form.quantity|as_crispy_field }}
                {{ form.notes|as_crispy_field }}
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <a href="{% url 'beads:list' %}" class="btn btn-outline-secondary rounded-pill px-3">
            <i class="bi bi-x-lg me-1"></i>Annuler
          </a>
          <button type="submit" class="btn btn-primary rounded-pill px-4">
            <i class="bi bi-check-lg me-1"></i>
            {% if form.instance.pk %}Mettre à jour{% else %}Ajouter{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>

  {% block extra_js %}
    <script src="{% static 'js/bead_form.js' %}"></script>
  {% endblock %}
{% endblock %}
