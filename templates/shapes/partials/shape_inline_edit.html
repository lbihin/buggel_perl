{% load i18n %}
{% csrf_token %}
<form class="inline-edit-form" 
  hx-post="{% url 'shapes:shape_inline_update' shape.id %}" 
  hx-target="#dimensions-display-{{ shape.id }}" 
  hx-swap="innerHTML">
  
  <input type="hidden" name="auto_update_type" value="true">

  <div class="simple-dimensions-edit">
    <div class="mb-2">
      <label class="form-label fw-bold">{% trans "Choisissez un type de forme :" %}</label>
      
      <!-- Options de forme sous forme de boutons radio -->
      <div>
           <div class="form-check mb-2">
           <input class="form-check-input" type="radio" name="edit_shape_option" id="edit_option_rectangle_{{ shape.id }}" value="rectangle" 
             {% if shape.shape_type == 'rectangle' %}checked{% endif %}
             hx-post="{% url 'shapes:shape_type_update' shape.id %}"
             hx-trigger="change"
             hx-include="closest .inline-edit-form"
             hx-target="#shape-type-{{ shape.id }}"
             hx-swap="innerHTML">
          <label class="form-check-label" for="edit_option_rectangle_{{ shape.id }}">
            {% trans "Rectangle" %}
          </label>
          
          <!-- Champs pour rectangle -->
          <div id="edit_rectangle_fields_{{ shape.id }}" class="edit-dimension-fields mt-1 ms-4" 
               {% if shape.shape_type != 'rectangle' %}style="display: none"{% endif %}>
            <div class="input-group">
              <span class="input-group-text">{% trans "Largeur" %}</span>
              <input type="number" name="width" value="{{ shape.width|default:'10' }}" min="1" required class="form-control form-control-sm" />
            </div>
            <div class="input-group mt-1">
              <span class="input-group-text">{% trans "Hauteur" %}</span>
              <input type="number" name="height" value="{{ shape.height|default:'10' }}" min="1" required class="form-control form-control-sm" />
            </div>
          </div>
        </div>
        
           <div class="form-check mb-2">
           <input class="form-check-input" type="radio" name="edit_shape_option" id="edit_option_square_{{ shape.id }}" value="square" 
             {% if shape.shape_type == 'square' %}checked{% endif %}
             hx-post="{% url 'shapes:shape_type_update' shape.id %}"
             hx-trigger="change"
             hx-include="closest .inline-edit-form"
             hx-target="#shape-type-{{ shape.id }}"
             hx-swap="innerHTML">
          <label class="form-check-label" for="edit_option_square_{{ shape.id }}">
            {% trans "Carré" %}
          </label>
          
          <!-- Champs pour carré -->
          <div id="edit_square_fields_{{ shape.id }}" class="edit-dimension-fields mt-1 ms-4"
               {% if shape.shape_type != 'square' %}style="display: none"{% endif %}>
            <div class="input-group">
              <span class="input-group-text">{% trans "Côté" %}</span>
              <input type="number" name="size" value="{{ shape.size|default:'10' }}" min="1" required class="form-control form-control-sm" />
            </div>
          </div>
        </div>
        
        <div class="form-check">
          <input class="form-check-input" type="radio" name="edit_shape_option" id="edit_option_circle_{{ shape.id }}" value="circle" 
                 {% if shape.shape_type == 'circle' %}checked{% endif %}
                 hx-post="{% url 'shapes:shape_type_update' shape.id %}"
                 hx-trigger="change"
                 hx-include="closest .inline-edit-form"
                 hx-target="#shape-type-{{ shape.id }}"
                 hx-swap="innerHTML">
          <label class="form-check-label" for="edit_option_circle_{{ shape.id }}">
            {% trans "Cercle" %}
          </label>
          
          <!-- Champs pour cercle -->
          <div id="edit_circle_fields_{{ shape.id }}" class="edit-dimension-fields mt-1 ms-4"
               {% if shape.shape_type != 'circle' %}style="display: none"{% endif %}>
            <div class="input-group">
              <span class="input-group-text">{% trans "Diamètre" %}</span>
              <input type="number" name="diameter" value="{{ shape.diameter|default:'10' }}" min="1" required class="form-control form-control-sm" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No inline JS here: radio changes now call the server endpoint `shape_type_update` via HTMX
       which will return an updated `#shape-type-{{ shape.id }}` fragment. The table cell
       that contains dimensions (`#dimensions-display-{{ shape.id }}`) is configured to
       reload on the `shapeTypeChanged` HX-Trigger emitted by the server, so the UI stays
       consistent without client-side scripting. -->

  <div class="inline-edit-actions">
    <button type="submit" class="save-inline-btn" title="{% trans "Sauvegarder" %}"><i class="bi bi-check"></i></button>
    <button type="button" class="cancel-inline-btn" hx-get="{% url 'shapes:shape_dimensions' shape.id %}" hx-target="#dimensions-display-{{ shape.id }}" hx-swap="innerHTML" title="{% trans "Annuler" %}"><i class="bi bi-x"></i></button>
  </div>
</form>
